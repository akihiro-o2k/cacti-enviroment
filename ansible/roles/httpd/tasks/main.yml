---

# Apache2.4のインストール
- name: Install Apache2
  become: yes
  apt: pkg=apache2 state=latest

- shell: apache2 -v
  register: apache_version

# 起動時有効化設定
- name: http service state
  become: yes
  service:
    name: apache2
    state: started
    enabled: yes

# ->Ubuntu20でインストールできるphpは7.4の為、リポジトリを追加
- name: Install repository ppa:ondrej/php
  become: yes
  expect:
    command: add-apt-repository ppa:ondrej/php
    responses:
      # 対話式で期待する文字列が発生したら空白[＋Enter]を送信
      'Press \[ENTER\] to continue or Ctrl-c to cancel adding it.': ''

# php8.0以降のパッケージをインストールする為にaptリポジトリの更新
- name: Apt update
  become: yes
  apt:
    update_cache: yes

# php.versionをインストール
- name: Install php and modules
  become: yes
  apt:
    name:
      "{{ php_packages }}"

# Module追加後にapache2のリロード
- name: Reload service apache2, in all cases
  ansible.builtin.systemd:
    name: apache2.service
    state: reloaded

# php動作確認fileのアップロード
- name: create /var/www/html/info.php
  template:
    src: var/www/html/info.php
    dest: /var/www/html/info.php
    owner: root
    group: root
    mode: 0644
